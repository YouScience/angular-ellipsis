angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(a,b,c){var d=function(b){var c=null,d=[];this.remove=function(b){-1!==d.indexOf(b)&&(d.splice(d.indexOf(b),1),0===d.length&&(a.cancel(c),c=null))},this.add=function(e){-1===d.indexOf(e)&&d.push(e),c||(c=a(function(){var a=d.slice();c=null,d.length=0,a.forEach(function(a){a()})},b))}},e=new d(0),f=new d(75);return{restrict:"A",scope:{ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"="},compile:function(a,c,d){return function(a,c,d){function g(a){for(var b,c=[],d=/\s+/gm;null!==(b=d.exec(a));)c.push(b.index);return c}function h(a,b,c){return a.substr(0,b[c])}function i(a,b,d,e){var f=h(a,b,d);return n.innerHTML=f+e,k(c)}function j(){if("undefined"!=typeof a.ngBind){var b=a.ngBind,e=g(b);d.isTruncated=!1,c.html(b);var f=c[0].clientHeight,j=c[0].scrollHeight;if(j>f){for(var k,l=e.length,m=0,n=l-1,o=!0,p=!0,q=!0,r=0,s="undefined"!=typeof d.ellipsisSymbol?d.ellipsisSymbol:"&hellip;",t="undefined"!=typeof a.ellipsisAppend&&""!==a.ellipsisAppend?s+"<span>"+a.ellipsisAppend+"</span>":s;q;)k=m+(n-m>>1),p=i(b,e,k,t),r++,p!==o&&n-m===1?q=!1:p?n=k:m=k;var u=h(b,e,k)+t;c.html(u),d.isTruncated=!0,s!==t&&"undefined"!=typeof a.ellipsisAppendClick&&""!==a.ellipsisAppendClick&&c.find("span").bind("click",function(b){a.$apply(function(){a.ellipsisAppendClick.call(a,{event:b})})})}}}function k(a){return a[0].scrollHeight>a[0].clientHeight}function l(){(d.lastWindowResizeWidth!=window.innerWidth||d.lastWindowResizeHeight!=window.innerHeight)&&j(),d.lastWindowResizeWidth=window.innerWidth,d.lastWindowResizeHeight=window.innerHeight}function m(){f.add(l)}d.lastWindowResizeTime=0,d.lastWindowResizeWidth=0,d.lastWindowResizeHeight=0,d.lastWindowTimeoutEvent=null,d.isTruncated=!1;var n=c[0];a.$watch("ngBind",function(){e.add(j)}),a.$watch("ngBindHtml",function(){e.add(j)}),a.$watch("ellipsisAppend",function(){j()}),a.$watch(function(){return 0!==c[0].offsetWidth&&0!==c[0].offsetHeight},function(){f.add(j)});var o=a.$on("dibari:refresh-ellipsis",function(){e.add(j)}),p=angular.element(b);p.bind("resize",m),a.$on("$destroy",function(){p.unbind("resize",m),e.remove(j),f.remove(l),o&&(o(),o=null)})}}}}]);